cards_prep:
  handler: cards_prep.worker
  destinations:
    onSuccess: ${cf:magicml-similarity-${self:custom.stage}.GetUnderscoreembeddingsLambdaFunctionQualifiedArn}
  memorySize: 5000
  timeout: 900
  maximumRetryAttempts: 0
  layers:
    - {Ref: PythonRequirementsLambdaLayer}
  events:
    - http:
        path: cards_prep
        method: get
        cors: true
        authorizer: aws_iam
    - s3:
        bucket: ${self:custom.raw_data_bucket}
        event: s3:ObjectCreated:*
        rules:
          - prefix: scryfall/
          - suffix: .json
        existing: true
  fileSystemConfig:
    localMountPath: '/mnt${self:custom.data_prep_mnt_path}'
    arn: ${cf:magicml-common-${self:custom.stage}.accessPointAArn}